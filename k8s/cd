pipeline {
  agent {
    kubernetes {
      yaml '''
        apiVersion: v1
        kind: Pod
        spec:
          containers:
          - name: sdk
            image: google/cloud-sdk
            command:
            - sleep
            args:
            - 99d
            tty: true
        '''
    }
  }

    stages {
	  stage('Deploy Production') {
            steps{
            	withCredentials([file(credentialsId: 'gcloud-service-auth', variable: 'GC_KEY')]) {
    				sh("gcloud auth activate-service-account --key-file=${GC_KEY}")
   				sh("gcloud container clusters get-credentials primary --zone us-central1-a --project ${project}")
  				}
  		 withKubeConfig([credentialsId: 'mostafa-ashour-project', serverUrl: 'https://35.224.32.45']) {
     				 sh 'kubectl apply -f /k8s/app/python-deploy.yaml'
   			 }
            	
               
        } 
	}
}
}





















